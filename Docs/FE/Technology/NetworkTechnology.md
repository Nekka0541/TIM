# ネットワーク技術

## ネットワーク方式

### LAN
- 建物内、敷地内などの比較的狭い範囲内で敷設したネットワークのこと

#### 有線LAN
- イーサネット
- IEEE802.3

アクセス制御方式の一つにCSMA/CD(Carrier Sense Multiple with Collision Detection)がある
- 伝送路上でのデータ衝突（コリジョン）を検知したらランダムな時間を待って再送する方式

#### 無線LAN
- IEEE802.11
- ESSID
  - 無線ネットワークを識別する文字列

### WAN
- 遠隔地にあるLAN同士を接続する広域ネットワーク
- 様々な通信事業者から様座なサービスが提供されている
  - 専用線サービス
    - 特定の相手との間を固定的に接続
  - 回線交換サービス
    - 必要な時だけ接続。接続時間で課金
  - パケット交換サービス
    - データを一定の大きさ（パケット）に分割。回線は共用

### モバイル通信サービス
- 通信事業者の電波を使ってスマホやタブレットからネットに接続するサービス
- SIMカード
  - 通信事業者などから提供される契約情報などが書き込まれている
  - 端末に挿入することで通信する。
- e-SIM
  - 物理的なSIMカードの交換なしで契約情報を書き換えられる。
- LTE(4G)
  - 通信速度が数十Mbpsの速度が出る方式
- テザリング
  - スマートフォンなどの端末をアクセスポイントのように用いることができる機能

#### MVNO
- Mobile Virtual Network Operator:仮想移動体通信事業者
- 自前の回線網を持つ通信事業者の移動通信網を借用し、自社ブランドで通信サービスを提供する業者
- 格安SIMはMVNOが提供している。

#### 5G
- 5Generation
- 第５世代移動通信システム
- 超高速、超低遅延、多数同時接続の３つの特徴を持つ

#### キャリアアグリゲーション
- 複数の異なる周波数帯を束ねて、より広い帯域を使うことで無線通信の高速化や安定化を図る手法

> 輻輳（ふくそう）
> - 通信が急増することによって、ネットワークの許容量を超えて、つながりにくくなる現象

### IoTネットワーク
- 生活で使う家電など、いろんなものをネットにつなごう的なやつ
- IoTでは高速な通信が不要の場合がある。
- IoT用のネットワークとして、低速ですが低電力で広範囲をカバーする**LPWA(Low Power Wide Area)**というネットワークの整備が進められている。

## 通信プロトコル
### OSI基本参照モデル
- 一昔前まではベンダごとにコンピュータのアーキテクチャが異なっていたため、ベンダが違うとコンピュータ同士を接続することを難しかった。
- そこで、ネットワークアーキテクチャを標準化するためにISO（国際標準機構）が７階層にまとめ、機能を定めた。これを**OSI基本参照モデル**と呼ばれている。
- このモデルに準拠して通信機器やアプリケーションを開発すればベンダが異なっていても接続して通信できる。
- 各階層（レイヤー）の役割

| レイヤ               | 説明                                                                                   |
| :------------------- | :------------------------------------------------------------------------------------- |
| アプリケーション層   | アプリケーション固有の機能を提供する                                                   |
| プレゼンテーション層 | データの表現形式を統一する                                                             |
| セッション層         | 通信の開始から終了までを提供する                                                       |
| トランスポート層     | エンドシステム間（複数のネットワークにまたがるコンピュータ間）の通信の信頼性を確保する |
| ネットワーク層       | エンドシステム間の通信を提供する                                                       |
| データリンク層       | 隣接したコンピュータ間の通信を提供する                                                 |
| 物理層               | ネットワークの物理的な機能を提供する                                                   |

### TCP/IP
- プロトコル（インターネットプロトコル）
  - ネットワーク上でコンピュータ同士が通信するときに使用する手順や約束事
- 現状TCP/IPがRFCで規定され、インターネットで広く使われているプロトコル体系ということで、市場原理によって最も多くの利用者を獲得し、**事実上の業界標準（デファクトスタンダード）**　となっている。
- TCP/IP(Transmission Control Protocol / Internet Protocol)
  - TCPとIPという二つのプロトコルを中心として構成され、基本参照モデルの各層と対応している。

| OSI基本参照モデル    | TCP／IP                        | 主なプロトコル                           |
| :------------------- | :----------------------------- | ---------------------------------------- |
| アプリケーション層   | アプリケーション層             | HTTP,FTP,TELNET,SNMP,NTP,SMTP,POP3,IMAP4 |
| プレゼンテーション層 |                                |                                          |
| セッション層         |                                |                                          |
| トランスポート層     | トランスポート層               | TCP,UDP                                  |
| ネットワーク層       | インターネット層               | IP,ICMP,ARP                              |
| データリンク層       | ネットワークインターフェース層 | PPP,PPPoE                                |
| 物理層               |                                |                                          |

#### アプリケーション層のプロトコル
- HTTP
  - Hypertext Transfer Protocol
  - HTML文書などを送受信する
- FTP
  - File Transfer Protocol
  - ファイルの転送
- SNMP
  - Simple Network Management Protocol
  - ネットワーク上の構成機器や障害時の情報収集を行う
- NTP
  - NetworkTimeProtocol
  - タイムサーバの時刻をもとに複数のコンピュータの時刻を同期させる
- SMTP
  - Simple Mail Transfer Protocol
  - メールを送信するときやメールサーバ間でメールを転送する
- POP3
  - Post Office Protocol Version 3
  - メールサーバのメールボックスからメールを受信する。
- IMAP4
  - Internet Message Access Protocol Version 4
  - POPとは違いメールサーバ上のメールボックスから必要なものだけを選択して受信する。

> - SMTP,POP3のイメージだ！
>
> はがきを相手に送る際、はがきを最寄りのポストに入れ、その後はいくつもの集配局を渡り、最終的に相手の郵便ポストに配送される。（SMTP）相手は郵便ポストからはがきを取り出します。（POP3）

#### トランスポート層のプロトコル
- TCP
  - Transmission Control Protocol
  - 通信相手と通信ができたかを確認する。信頼性の高いデータ転送を提供。
- UDP
  - User Datagram Protocol
  - 信頼性は保障しないが、高速なデータ転送を提供する

#### インターネット層のプロトコル
- IP
  - InternetProtocol
  - IPアドレスを用いてデータを通信相手まで届ける
- ICMP
  - Internet Control Message Protocol
  - 通信相手との通信状況をメッセージで返す。

#### memo
- ping
  - ICMPを用いてIPパケットが通信相手に正しく届いているかを確認するためのコマンド

- MACアドレスとARP
  - MACアドレス
    - LANボードやLANカードなどのNICにあらかじめ割り振られた世界で一意の物理アドレス
  - ARP（Address Resolution Protocol）
    - IPアドレスからMACアドレスを取得するときに使われるプロトコル
  - RARP
    - 逆にMACアドレスからIPを取得するプロトコル

- ノード
  - ネットワークの分野ではネットワークに接続された機器やネットワークとネットワークを接続する機器のことをいう。

- IPアドレスとMACアドレス
  - IPアドレスは最終的な通信相手を指す
  - MACアドレスは次の通信相手をさす。

#### ネットワークインターフェース層のプロトコル
- PPP
  - 2地点間を接続して通信する。ダイヤルアップなどで用いる。
  - Point-to-Point Protocol
- PPPoE
  - PPP over Ethernet
  - LAN上でPPPを行い、常時接続する。

## ネットワーク接続機器

### パケット
- ネットワーク上を流れるデータを小さく分割したもの

### データ転送単位
- OSI参照モデルでは階層ごとのデータをセグメント、パケット、フレームと呼んでいる
- 送信時には上位層から下位層に至るまでにヘッダ情報が追加される。
- 受信時には階層が上がるごとにヘッダ情報が削除されていく。
  - ヘッダ情報
    - ＴＣＰヘッダ
      - 送信元とあて先のポート番号など
    - IPヘッダ
      - 送信元とあて先のIPアドレスなど
    - MACヘッダ
      - 送信元とあて先のMACアドレスなど

### ネットワーク接続機器
- OSI参照モデルと機器との対応表

| OSI基本参照モデル    | 接続機器                               |
| :------------------- | :------------------------------------- |
| アプリケーション層   | ゲートウェイ                           |
| プレゼンテーション層 |                                        |
| セッション層         |                                        |
| トランスポート層     |                                        |
| ネットワーク層       | ルータ・L3スイッチ                     |
| データリンク層       | ブリッジ・スイッチングハブ・L2スイッチ |
| 物理層               | リピータ                               |

#### リピータ
- LANにおいて物理層で中継する装置
- 伝送距離を延長するために伝送路の途中でデータの信号波形を増幅・整形する。

#### ブリッジ
- LANどうしを接続し、データリンク層で中継する装置
- フレームのMACアドレスを解析し、適切なネットワークに中継する。

#### memo
- スイッチングハブ
  - LANケーブルを束ねる集線装置
  - 受信したフレームのあて先MACアドレスを解析し、宛先MACアドレスが存在するLANポートにだけ転送する。
- L2スイッチ
  - 機能としてはスイッチングハブと同じ
  - 仮想ネットワーク（VLAN）を加えたものもある。

#### ルータ
- LAN同士やLANとWANを接続してネットワーク層で中継する装置
- パケットのあて先IPアドレスを解析し、最適な経路を選択（ルーティング）市中継する。
- L3スイッチ
  - ルータと同じ機能を持つ

#### ゲートウェイ
- トランスポート層以上が異なるネットワーク同士でプロトコル変換を行う装置

## IPアドレス
### IPアドレス
- TCP/IPネットワーク上にある端末やネットワーク機器を識別するための番号
- IPv4
  - 2進32ビット
  - 見やすくするため、８ビット単位でドットごとに区切り、10進数に変換して表現している。

### ドメイン名
- IPアドレスをさらに人が理解しやすいように文字列に置き換えた別名
- FQDN
  - ホスト名（www.）ドメイン名（ipa.go.jp）、のフルセットのこと。

### DNS
- Domain Name System
- ドメイン名やホスト名などとIPアドレスとを対応付けるシステムで、これを担当するのがDNSサーバ
- 例えばDNSサーバに対して[www.ssss.co.jp]は？と尋ねるとDNSサーバ側から[192.168.55.2]だよと答えてくれる。これを**名前解決**と呼ぶ

### グローバルIPアドレスとプライベートIPアドレス
#### グローバルIPアドレス
- インターネットで使用するIPあどれす
- 世界で一意になるようにICANNという組織によって管理されている

#### プライベートIPアドレス
- LANなどの独立したネットワークで使用するIPあどれす
- 独立したネットワーク内で一意になるように、組織のネットワーク管理者によって管理されている。

### DHCP
- Dynamic Host Configuration Protocol
- コンピュータがネットワークに接続する際に必要となるIPアドレスなどの設定を自動的に割り当てるプロトコル

### ポート番号
- 通信相手のアプリケーションを識別するために使用される番号。0~65535の番号が割り当てられる。
- ウェルノウンポート
  - 特定のアプリケーションの為に予約されているポート番号(0~1023までの範囲)
  - 代表的なウェルノウンポート番号と対応するアプリケーション

| アプリケーション名 | ポート番号 |
| :----------------- | :--------- |
| FTP転送            | 20         |
| FTP制御            | 21         |
| SMTP               | 25         |
| DNS                | 53         |
| HTTP               | 80         |
| POP3               | 110        |

### NATとNART
- LAN内の端末にはそれぞれプライベートIPアドレスが割り振られているが、インターネットにアクセスするときはグローバルIPアドレスが必要になる。
- その際の助けとなるのが**NAT**と**NART**である。通常ルータの機能の一部として備えられている。

#### NAT
- Network Address Translation
- 一つのグローバルIPアドレスと一つのプライベートIPアドレスを相互変換する技術

#### NAPT
- Network Address Port Translation
- 一つのグローバルIPアドレスと複数のプライベートIPアドレスを相互変換する技術
- IPマスカレードとも呼ばれている。
- NATの技術とポート番号を組み合わせたもの
- プライベートIPアドレスとポート番号の組とグローバルIPアドレスとポート番号の組を相互に変換し、一つのグローバルIPアドレスでLAN上の複数の端末からインターネットに接続することができる。

## IPアドレスのクラス
- [IPアドレスのまとめ](https://www.seplus.jp/dokushuzemi/ec/fe/fenavi/mastering_tech/ip_address_subnet_mask/)
### IPアドレスのクラス
- IPv4では32ビットをネットワーク部とホスト部に分け、どのネットワークに属する、どのホストか？で管理している。
- ホストはネットワーク上のサーバや端末のこと
- ネットワークアドレス
  - ホスト部の２進数ビットがすべて0になるアドレス
  - ネットワーク自体を指すアドレスして使用される
- ブロードキャストアドレス
  - ホスト部の２進数ビットがすべて１になるアドレス
  - あるセグメントに接続されているすべてのホストにパケットを送信するためのアドレス
- 32ビットを8ビット単位に、ネットワーク部とホスト部を何ビットずつで構成するのかで、次のようなクラス分けをしている。

| クラス | ネットワーク部 | ホスト部 | 接続可能なホスト台数  | 対象とするネットワーク |
| :----- | :------------- | -------- | --------------------- | ---------------------- |
| A      | 8ビット        | 24ビット | $2^{24}-2=16777214台$ | 大規模                 |
| B      | 16ビット       | 16ビット | $2^{16}-2=65534台$    | 中規模                 |
| C      | 24ビット       | 8ビット  | $2^8-2=254台$         | 小規模                 |

プライベートIPアドレスはアドレスクラスごと割り当てられる範囲が次の表のように決まっている。
| アドレスクラス | プライベートIPアドレスの範囲 |
| :------------- | :--------------------------- |
| クラスA        | 10.0.0.0~10.255.255.255      |
| クラスB        | 172.16.0.0~172.31.255.255    |
| クラスC        | 192.168.0.0~192.168.255.255 |

### サブネッティング
- ホスト部の情報を分割し、複数のより小さいネットワーク（サブネット）を形成することができる。w
  - サブネッティングと呼ばれている。
- ネットワーク部を拡張することで、32ビットを、ネットワーク部とサブネット部ホスト部に分け、どのネットワークに属する、どのサブネットワークの、どのホストか？で管理している。

### サブネットマスク
- IPアドレスとネットワーク部とホスト部を区切るために使用するビット列
- ネットワーク部には１をホスト部には０を指定する。

### IPv6
- 現状広く使用されているIPv4だが、急速に普及したため新規に割り当てられるIPv4のアドレスがなくなってしまった
- そこで128ビットに拡張したIPv6への移行が進められている。
- v4,v6はの機器はそのままでは共存できない
- 一つの機器に両方のプロトコルスタックを持たせるデュアルスタックや、通信の仲立ちをするトランスレータ、IPv4パケットの中にIPv6アドレスを入れ込むカプセル化（トンネリング）などを使って相互に通信することができる。

#### IPsec
- Security Architecture for Internet Protocol
- TCP/IPネットワークで暗号通信を行うための通信プロトコル
- IPパケットを暗号化する機能があり、v6には標準で組み込まれている。

## ネットワーク管理とインターネットの応用
### ネットワーク管理
- ネットワーク機器の追加や構成を変更するにはケーブルの抜き差しやネットワーク機器を一つ一つ設定する必要があったため大変だった。そこで登場したのがSDNだった
- SDN
  - Software Defined Networking
  - ソフトウェアによりネットワーク機器を集中的に制御してネットワークの構成や設定を動的に変更する技術総称です。
- OpenFlow
  - 従来のネットワーク機器が持つ機能「経路制御」「データ転送」を分離

### インターネットの応用
#### URL
- Uniform Resource Locator
- Web上で取得したいWebページなどの情報源の場所を表記する方法
- URI
  - Uniform Resource Identifier
  - Webの情報源を一意に識別する総称
- URN
  - Uniform Resource Name
  - 情報源の名前を一意に特定するもの

#### CGI
- Common Gateway Interface
- Webブラウザからの要求に対して、Webサーバが外部のプログラムを呼び出し、その結果をHTTPを介してWebブラウザ二返す仕組み

#### MIME
- Multipurpose Internet Mail Extension
- 電子メールの規格を拡張して、様々な形式を扱えるようにした規格
- S/MIME
  - Secure /MIME
  - MIMEに暗号化と著名をする仕組みを加えた規格

#### メールヘッダ
- SMTPでメールを送信する際にメール本文のデータに加えて付加される様々な制御情報
- 次の種類のヘッダ情報がある
  - From
  - To
  - Cc
  - Bcc
  - Return-Path
  - X-Mailer
  - Received

### 回線に関する計算
- bps(bit per second)
  - １秒あたりに転送されるビット数
  - ビット／秒という表記もある
  - 計算問題の種類によってそれぞれ変換が必要
    - 通信速度や符号化速度はビット／秒
    - データ量はバイト
  - 例題：1.5Mビット／秒の回線で12Mバイトのデータを転送するのに要する時間は？回線利用率は50%とする
    - 回線速度は1.5Mビット／秒とビット換算なので、データ量をビットに変換する。
    - $12Mバイト=12\times8=96Mビット$
    - 回線利用率の計算をする。50%なので
    - $1.5M\times0.5=0.75Mビット$となる。これが１秒間に送れるデータ量となる。
    - 送信データ量：96Mビットを１秒当たりに送るデータ量：0.75で割る
    - $96Mビット\div0.75=128$答えは128秒になる。