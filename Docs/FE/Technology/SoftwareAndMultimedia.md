- [ソフトウェア](#ソフトウェア)
  - [OS](#os)
    - [制御プログラム](#制御プログラム)
    - [API](#api)
  - [OSS](#oss)
    - [OSSのライセンス](#ossのライセンス)
- [ジョブ管理とタスク管理](#ジョブ管理とタスク管理)
  - [ジョブとタスク](#ジョブとタスク)
  - [ジョブ管理](#ジョブ管理)
    - [スプーリング](#スプーリング)
  - [タスク管理](#タスク管理)
    - [タスクの状態遷移](#タスクの状態遷移)
    - [タスクのスケジューリング](#タスクのスケジューリング)
    - [マルチタスク](#マルチタスク)
    - [割込み処理](#割込み処理)
    - [待ち行列モデル](#待ち行列モデル)
- [記憶管理](#記憶管理)
  - [記憶管理](#記憶管理-1)
## ソフトウェア

### OS
オペレーティングシステムはハードウェアやアプリケーションソフトウェア（応用ソフトウェア）を管理・制御するソフトウェア
**基本ソフトウェア**とも呼ばれている。

#### 制御プログラム
制御プログラムは、ハードウェア資源の状態を常に監視し、コンピュータの効率的な利用を実現するソフトウェア群

| 機能         | 説明                                                                                                   |
| :----------- | :----------------------------------------------------------------------------------------------------- |
| ジョブ管理   | ジョブのスケジュール管理を行う。ジョブの投入から結果が出るまでの過程を提供する。                       |
| タスク管理   | CPUを効率よく使用するための割り当てを行う。CPUが複数のタスクを実行できるマルチタスクの機能を提供する。 |
| 記憶管理     | 主記憶を効率よく管理する。実記憶管理と仮想記憶管理を提供する。                                         |
| ファイル管理 | ディレクトリやファイルを管理するファイルシステムの機能を提供する。                                     |
| その他       | 入出力管理、通信監理、セキュリティ管理、運用管理、障害管理、など                                       |

- アプリケーションソフトウェア（応用ソフトウェア）
  - OS上で稼働する特定の目的を実現するためのソフトウェア
- ミドルウェア
  - OSとアプリケーションソフトウェアの中間に位置しており、統一的なインタフェースや共通の基本機能を提供するソフトウェア

#### API
Application Program Interfaceは、アプリケーションからOSが用意する各機能を利用するための仕組み
ソフトウェアの開発者は、１から処理内容を記述する必要はなく、そのAPIを使用することで効率よくソフトウェア開発ができる。

- デバイスドライバ 
  - PCに接続した周辺機器を制御するソフトウェア

### OSS
オープンソースソフトウェアは、ソースコードを公開しているSoftware
無保証を原則としている。
OSSを組み合わせてパッケージ化して再頒布する団体を**ディストリビュータ**という。

#### OSSのライセンス
OSSを利用する際のライセンス条件の代表的なものにBSDがある（Berkeley Software Distribution）ライセンスとGPL(GNU General Public License)がある
- BSDライセンス
次二つの条件
  - 無保証であること
  - 改変後の再頒布の際に元のSoftwareの著作権表示部分やライセンス条文は残すこと

- GPL
BSDの条件に加えてコピーレフトという制約がある
  - コピーレフト
    - 著作権を保持したまま、プログラムの複製や改変、頒布を制限せず、そのプログラムから派生した二次著作物（派生物）には、オリジナルと同じ配布条件を適応するという考え方。


|     | 保障   | 元ソースの著作権・ライセンス表示 | 変更したことの表示 | ソースコードの開示 | 別のライセンスにする |
| :-- | :----- | -------------------------------- | ------------------ | ------------------ | -------------------- |
| BSD | 無保証 | 必要                             | 不要               | 不要               | 可能                 |
| GPL | 無保証 | 必要                             | 必要               | 必要               | 禁止                 |

## ジョブ管理とタスク管理

### ジョブとタスク
- ジョブ
  - 利用者からみた仕事の単位
  - 利用者がコンピュータに実行を依頼する単一のプログラムや、バッチ処理などの一連のプログラム群の事。
- タスク(プロセス)
  - OSからみた仕事の単位
  - コンピュータに投入されたジョブはいくつかのタスクに分解される。
OSにはこれらのジョブやタスクを効率よく管理する機能がある

### ジョブ管理
- スケジューリング
  - ジョブの入力と出力を管理する。
  - コンピュータに投入されたジョブは、**入力待ち行列**に登録され、順番に処理されるのを待つ。
  - 処理された後は**出力待ち行列**に登録され、順番にプリンタなどに処理結果が出力されるのを待つ。
  - 入出力待ち行列は、先に入力されたものから先に出力されるキュー構造を持つ。

#### スプーリング
スプーリングとは主記憶装置と低速の入出力装置との間のデータ転送を、補助記憶装置を介して行うこと。
例えば、プリンタへの出力データを一時的に磁気ディスクに書き込み、プリンタの処理速度に合わせて少しずつ出力させる。
スループットの向上に役立つ

### タスク管理
タスク管理ではタスクを以下の3つの状態で管理する。

| 状態                  | 説明                                                                                                       |
| :-------------------- | :--------------------------------------------------------------------------------------------------------- |
| 実行可能状態（Ready） | CPUの使用権が割り当てられるのを待っている状態。実行可能状態のタスクが複数存在する待ち行列を形成している。  |
| 実行状態（Run）       | CPUの使用権が割り当てられ、実行している状態。CPUが一つしかない場合は、実行状態のタスクは一つだけ存在する。 |
| 待ち状態（Wait）      | 他のタスクが入出力装置を使用しているため、入出力処理が完了するのを待っている状態                           |

#### タスクの状態遷移
タスクは次のように遷移していく。
1. 生成された直後のタスクは**実行可能状態**となる
2. 実行可能状態のタスクから実行するタスクを選択して、そのタスクにCPUの使用権を割り当てると、**実行状態**へ遷移する。この**CPUの割り当て**を**ディスパッチ**という。
3. 実行状態中に、ほかの優先順位が高いタスクが実行可能状態になると、割り込みが発生し、優先順位の高いタスクにCPUの使用権が割り当てられる。現在の実行状態のタスクは**実行可能状態**へ遷移する。
4. 実行状態中に、入出力待ちが生じた場合は、入出力処理が完了するまで**待ち状態**へ遷移する。
5. 入出力処理が完了すれバ、**実行可能状態**に遷移する。


#### タスクのスケジューリング
複数のタスクの中から、どのタスクにCPUの使用権を割り当てるかを決める方式として、次のようなものがある。

| 方式               | 説明                                                                                                                                                            |
| :----------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 到着順方式         | 実行可能待ち行列の先頭にあるタスクから順に、CPUの使用権を割り当てる                                                                                             |
| 処理時間順方式     | 処理予定時間が最も短いタスクから順に、CPUの使用権を割り当てる                                                                                                   |
| 優先度順方式       | 優先度の高いタスクから順に、CPUの使用権を割り当てる。                                                                                                           |
| ラウンドロビン方式 | 実行可能待ち行列の先頭にあるタスクから順に、CPUの使用権を割り当て、一定時間（タイムスライス）が経過した場合は、実行を中断して、実行可能待ち行列の最後尾に加える |

#### マルチタスク
マルチタスクは複数のタスクにCPUの処理時間を順番に割り当てることで、タスクが同時に実行されているように見せる方式
これにより、CPUを有効活用することができる。**マルチプログラミング**とも呼ばれている。
I/O処理などの最中でCPUを利用しない期間があるとする。
この時間は**遊休時間（アイドルタイム）** と呼ばれている。

#### 割込み処理
割込みは実行中のプログラムを一時中断し、制御プログラムに制御を移して、必要とする別の処理に切り替えること。
割込みが発生すると、割り込みが発生したときに実行していた命令の現在のプログラムカウンタの値が退避され、割込み処理が実行される。
割込みが完了すると、退避されていたアドレスが復帰され、割り込まれた場所から実行が再開される。

- 内部割込み
  - 実行中のプログラムが原因で起こる

| 種類                        | 説明                                                                                 |
| :-------------------------- | :----------------------------------------------------------------------------------- |
| プログラム割込み            | ゼロによる除算、桁あふれ、ページフォルト、記憶保護例外など、不正な命令が原因で起こる |
| SVC割込み（SuperVisorCall） | プログラムがOSに入出力を要求したときなどに起こる                                     |

- 外部割込み
  - 実行中プログラム以外が原因

| 種類               | 説明                                                         |
| :----------------- | :----------------------------------------------------------- |
| 機械チェック割込み | 電源異常、主記憶の故障など、ハードウェアの故障が原因で起こる |
| 入出力割込み       | 入出力装置の入出力動作が完了したときに起こる                 |
| タイマ割込み       | プログラムの実行時間が設定時間を超過したときに起こる         |
| コンソール割込み   | オペレータが介入したときに起こる |

#### 待ち行列モデル
コンビニのレジなどで客が増えるとレジの処理が追い付かず、行列が発生したりする。
このようなときの平均待ち時間を求める時に使われるのが待ち行列モデルである。

- M/M/1の待ち行列モデル
  - 次の条件で考える。
    - 客の到着はランダム
    - レジの処理時間も客ごとにランダム
    - 処理する窓口は一つ
    - 先着順に処理
    - 列への割込みや途中抜けはない
  - コンピュータの世界に応用されてジョブを「客」CPUを「レジ」にあてはめたりして考える。

## 記憶管理

### 記憶管理
現在のほとんどのコンピュータは[プログラム記憶方式](./ComputerComponent.md/#プログラム記憶方式)で、プログラムは磁気ディスクなどの補助装置に保存されているが、実行時には主記憶上に配置し、実効が終われば主記憶上から消去される。（主記憶の解放）
記憶管理では、主記憶の容量には限りがあるため、主記憶を効率よく管理する。